---
description: Commit Protocol & Code Quality Standards
---

## 1. PRE-COMMIT CHECKLIST (Non-Negotiable)

Before creating any commit, you must ensure the health of the codebase. You are responsible for formatting, testing, and typechecking YOUR code before atomic-committing it. Do not rely on CI to catch basic errors.

### Required Checks
Run the following checks locally:

1.  **Format**: Ensure all code is formatted according to project standards (Prettier).
2.  **Lint**: Run static analysis to catch potential bugs and style violations (ESLint).
3.  **Type Check**: Validate type safety (TypeScript).
4.  **Test**: Run relevant unit tests for the changes made.

// turbo
Run this sequence before staging files (prioritize 'verify' if available):
```bash
npm run verify || (npm run format && npm run lint && npm run type-check && npm run test)
```

**Note on Automation**: If the project has automated hooks (like Husky or lint-staged) that perform these checks on commit, you may skip manual execution IF AND ONLY IF you are confident the hooks are active and covering the required checks. However, manual verification is always safer.

If any step fails, **fix it immediately**. Do not bypass these checks.

---

## 2. COMMIT MESSAGE CONVENTIONS

We follow the [Conventional Commits](https://www.conventionalcommits.org/) specification.

### Structure
```
<type>(<scope>): <subject>

<body (optional)>

<footer (optional)>
```

### Types
- **feat**: A new feature
- **fix**: A bug fix
- **docs**: Documentation only changes
- **style**: Changes that do not affect the meaning of the code (white-space, formatting, etc)
- **refactor**: A code change that neither fixes a bug nor adds a feature
- **perf**: A code change that improves performance
- **test**: Adding missing tests or correcting existing tests
- **chore**: Changes to the build process or auxiliary tools and libraries such as documentation generation

### Rules
- **Imperative mood**: "Add feature" not "Added feature"
- **No periods**: No dot at the end of the subject line
- **Lowercase**: Keep the subject lowercase
- **No agent files**: NEVER commit files located in the `.agent/` folder. This folder is for internal agent state and metadata, not project source code.

### Examples
- `feat(auth): implement jwt token generation`
- `fix(api): handle timeout error in user service`
- `style(ui): update button padding`

---

## 3. GIT WORKFLOW

### Atomic Commits (STRICT RULE)
1.  **Strict Atomicity**: Each commit should do **one thing**. Never combine unrelated changes.
2.  **No Bulk Commits**: Avoid "dumping" several hours of work into a single commit. Enforce a progressive, iterative commit history.
3.  **Handoff Dependency**: You MUST use the `.agent/COMMIT_LOG.md` generated by the builder to inform your commit message and atomicity grouping.

---

## 4. AGENT EXECUTION STEPS (The "Straight Shot")

To avoid redundant commands and ensure high-fidelity commits, follow this sequence:

1.  **Context Gathering**: Read `.agent/COMMIT_LOG.md`. This is MANDATORY for generating accurate, high-fidelity commit messages that reflect the builder's intent.
2.  **Discover**: Run `git status --porcelain` to identify changed files.
3.  **Inspect**: Run `git diff` and `view_file` to verify the logic matches the logs.
4.  **Verify**: Run the "Required Checks" (Linting, Testing, etc.).
5.  **Group**: Divide work into atomic units based on the `COMMIT_LOG.md`.
6.  **Document**: Update any relevant documentation (e.g., API docs, README) reflecting the new changes. **Note**: Do NOT update `CHANGELOG.md` at this stage; it will be consolidated by the `/merger` during the release commit.
7.  **Stage**: Use `git add <files>` for the current atomic unit. **Exclude `.agent/` files.**
8.  **Verify Staging**: Run `git status --porcelain` and `git diff --cached`.
9.  **Commit**: Execute `git commit -m "<message>"` using Conventional Commits logic derived from `COMMIT_LOG.md`.
10. **Cleanup**: IMMEDIATELY delete `.agent/COMMIT_LOG.md` after a successful commit (or the final commit in a series) to signify completion and clear the buffer for the next unit of work.

---

**Code is communication. Commits are history. Make them clean.**
